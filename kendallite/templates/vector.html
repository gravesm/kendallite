{% extends 'base.html' %}

{% block head_content %}
    <script>
        $(function() {

            var login_url;

            {% include 'maps/base.js' %}

            {% if authorized %}
                {% include 'maps/wms.js' %}
                {% include 'maps/wfs.js' %}
            {% else %}
                {% include 'maps/preview.js' %}
            {% endif %}

            login_url = "{{ config.SHIB_LOGIN_URL }}?target=";
            $("#login").attr("href", login_url + encodeURIComponent(location.href));

            $("[data-toggle=popover]").popover();

        });
    </script>
{% endblock %}

{% block download_controls %}
    {% if not authorized %}
        {% if layer.institution.lower() == 'mit' %}
            <a href="#" class="btn btn-sm btn-primary pull-right" id="login"
                title="Log in to view layer features">Log in</a>
        {% else %}
            <span class="pull-right glyphicon glyphicon-question-sign help" data-content="This layer cannot be downloaded because it is a restricted layer at another institution." data-placement="left" data-toggle="popover"></span>
        {% endif %}
    {% else %}
        <div class="btn-group pull-right">
            <button type="button" class="btn btn-default dropdown-toggle btn-sm"
                data-toggle="dropdown">
                Download as <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a href="{{ layer.location['wms'][0] }}?VERSION=1.1.1&REQUEST=GetMap&SRS=epsg:4326&BBOX={{ layer.minx }},{{ layer.miny }},{{ layer.maxx }},{{ layer.maxy }}&LAYERS={{ layer.layer_name }}&WIDTH=512&HEIGHT=512&FORMAT=kmz&TILED=no&format_options=kmattr:true;kmscore:100;">KMZ</a></li>
                <li><a href="{{ layer.location['wfs'] }}?service=wfs&version=2.0.0&request=GetFeature&typeName={{ layer.layer_name }}&outputFormat=shape-zip">Shapefile</a></li>
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% block map_overlay %}
    {% if authorized %}
        <div class="map-overlay overlay-background"></div>
        <div class="map-overlay overlay-text">Loading layer...</div>
    {% endif %}
{% endblock %}

{% block metadata %}
    {{ fgdc|safe }}
{% endblock %}